<h1>
  <%= link_to @contest.name, contest_url(@contest) %> /
  <%= @current_user.has_role?(:administrator) ? "Alle" : "Meine" %> <%= School.human_name(:count => 2) %>
</h1>

<% tabnav :contest do %>
  <% show_to :administrator do %>
    <div style="margin-bottom: 20px; font-weight: bold">
      <%= t("views.schools_registered", :schools => "<span class='schools_count'>#{@contest.schools.count}</span>") %></div>
    <div id="filter">
      Anzeige auf Bundesland beschränken: <%= select_tag "select_state",options_for_select(((@schools.collect{|s| s.state} | @other_schools.collect{|s| s.state}).collect{|s| [s, s.downcase]} << ["Alle", "all"]).sort{|a,b| a.first <=> b.first}) %>
    </div>
  <% end %>
  <table class="tablesorter data-table" id="schools">
    <thead>
      <tr>
        <th><%= School.human_attribute_name("name") %></th>
        <th><%= School.human_attribute_name("location") %></th>
        <th><%= School.human_attribute_name("state") %></th>
        <th class="middle"><%= PreliminaryContestant.human_name :count => 2 %></th>
        <th class="middle">Aktionen</th>
      </tr>
    </thead>
    <tbody>
      <% @schools.each do |school| %>
        <%= render :partial => "school", :locals => {:school => school} %>
      <% end %>
      <% unless @other_schools.empty? %>
        <tr class="medium-gap">
          <td>&nbsp;</td><td></td><td></td><td></td><td></td>
        </tr>
        <tr>
          <td colspan="5">
            <b>Die folgenden Schulen haben Sie nicht selbst angemeldet, aber ihnen Teams hinzugefügt</b>
          </td>
        </tr>
        <% @other_schools.each do |school| %>
          <%= render :partial => "school", :locals => {:school => school} %>
        <% end %>
      <% end %>
    </tbody>
  </table> 
<% end %>

<% show_to :administrator do %> 
 <% javascript_tag do %>
  var counts_for_state = <%=@schools_in_states.to_json.html_safe%>
  var count_all_schools = <%= @schools.count %>
  $("#schools").tablesorter({
    headers: {
      4: { sorter: false }
    }
  })
  
  $("#select_state").change(function(){
   var new_state = $("#select_state option:selected").val()
   if(new_state == "all"){
     $(".school").show()
     $(".schools_count").html(count_all_schools)
   }else{
     $(".school").hide()
     $("."+new_state).show()
     $(".schools_count").html(counts_for_state[new_state])
   }
  })
 <% end %>
<% end %>
