<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <style type="text/css">
    table.data-table {
      width: 100%;
      border-spacing: 0;
      font-size: 11px;
      text-align: left;
    }
  </style>


</head>
<body>
<h1 class="print-hide" id="title">
  <%= @contest.name %> /
  <%= @matchday.trial? ? "#{@matchday.position}. Probespieltag" : "#{@matchday.position - @matchday.contest.matchdays.trials.count}. Spieltag" %>
  <% if @matchday.played? and not @matchday.published? and administrator? %>
    (<%=t "views.unpublished" %>)
  <% elsif not @matchday.played? or not @matchday.published? %>
    (<%= t "views.outstanding" %>)
  <% end %>
 
</h1>
<% ranking = (logged_in? and @current_user.teams.visible.ranked.for_contest(@contest).count == 1) ? @current_user.teams.for_contest(@contest).first.ranking : nil %>
<% ranking = "all" if local_assigns[:ranking].nil? %>
<h2 class="print-inline">Rangliste der <%= @contest.name %> "<%= @contest.game_name %>"<br><br></h2>
<% if not ranking == "all" %>
  <h3 class="print-inline">Wertung: <%= t("views.ranking.#{ranking}") %></h3>
<% end %>
<table class="data-table">
  <thead>
    <tr>
      <th style="text-align:left" width="10%"><%= t "views.position" %> </th>
      <th style="text-align:left"><%= t "views.contestant" %></th>
      <th style="text-align:left" class="print-inline">Ort</th>
      <th style="text-align:left" class="right"><%= t "views.matches" %></th>
      <% @contest.game_definition.match_score.each do |k,fragment| %>
        <th style="text-align:left" class="right <%= match_score_fragment_name(@contest.game_definition, fragment).include?("Zeit") ? "print-hide" : "" %>"><%= match_score_fragment_name(@contest.game_definition, fragment) %></th>
      <% end %>
      <% if ranking == "all" %>
        <th style="text-align:left" class="middle space-left">&Delta;</th>
      <% end %>
    </tr>
  </thead>
  <% @matchday.slots.find_all{|slot| !slot.contestant.hidden? and slot.contestant.ranked? and (ranking == "all" ? true : slot.contestant.ranking == ranking)}.each_with_index do |slot,i| %>
    <tr class="<%= i.odd? ? 'odd': 'even' %>" style="line-height: 2em;">
      <td><%= i + 1 %>.</td>
      <td><%= slot.contestant.disqualified ? "<i>#{t "views.disqualified"}</i>".html_safe! : "" %> <%= slot.contestant.name %></td>
      <td class="print-inline"><%= slot.contestant.location %></td>
      <td><%= count_matches_played_by_contestant(slot.contestant, @matchday) %></td>
      <% if slot.score %>
        <% slot.score.to_a_with_precision.each_with_index do |value,i| %>
          <td <%= slot.score.fragments[i].fragment.include?("time") ? "print-hide" : "" %>"><%=h value %></td>
        <% end %>
      <% else %>
        <td colspan="<%= @contest.game_definition.match_score.size %>">
          <em><%= t "views.error_no_result" %></em>
        </td>
      <% end %>
      <% if ranking == "all" %>
        <td class="middle space-left">
          <% previous_position = slot.previous_position %>
          <% if previous_position %>
            <% diff = previous_position - slot.position %>
            <% if diff > 0 %>
              <span style="font-size: 10px; color: #090; font-weight: bold;">+<%= diff %></span>
            <% elsif diff < 0 %>
              <span style="font-size: 10px; color: #f00; font-weight: bold;"><%= diff %></span>
            <% else %>
              <span style="font-size: 10px; color: #999;">&plusmn;0</span>
            <% end %>
          <% else %>
            <span style="font-size: 10px; color: #999;">-</span>
          <% end %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>
</div>
</body>
</html>
