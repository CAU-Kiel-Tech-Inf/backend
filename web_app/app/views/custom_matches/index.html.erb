<h1><%= t "views.administration" %></h1>

<% tabnav :administration do %>
  <div style="border: 1px #000 solid; width: 100%; text-align: center; padding-bottom: 20px">
    <h3>Neues Spiel</h3>
    <% form_for :match, contest_custom_matches_url(@contest)  do |f| %>
      <table style="width: 100%">
        <tr>
          <td>
            <%= f.label Contestant.human_name + " 1" %>
            <%= collection_select :match, :contestant1, @contest.all_contestants.reject{|c| c.current_client.nil?}, :id, :name %>
          </td>
          <td>
            <%= f.label Contestant.human_name + " 2" %>
            <%= collection_select :match, :contestant2, @contest.all_contestants.reject{|c| c.current_client.nil?}, :id, :name %>
          </td>
        </tr>
      </table>

      <span style="margin-right: 15px">
        <%= t("views.over") %>
        <%= select :match, :rounds, (2..6).step(2) %>
        <%= t("activerecord.models.round.other") %>
      </span>
      <%= submit_tag t("actions.create").capitalize, :style => "margin-top: 10px" %>
    <% end %>
  </div> 

  <h3>Match</h3>
  <table style="width: 100%">
    <thead style="text-align: left">
      <th><%= Contestant.human_name + " 1" %></th>
      <th><%= Contestant.human_name + " 2" %></th>
      <th>Rundenzahl</th>
      <th>&nbsp;</th>
    </thead>
    <% @contest.custom_matches.each do |mm| %>
      <tr>
        <td><%= mm.contestants.first.name %></td>
        <td><%= mm.contestants.second.name %></td> 
        <td><%= mm.rounds.count %></td>
        <td>
          <% if not mm.played? and not mm.running? %>
            <a href="#" id="open_box_<%= mm.id %>"><%= t("actions.play") %></a>
            <div id="prio_box_<%= mm.id %>" style="padding: 10px; position: absolute; background-color: #ddd; border: 1px solid #aaa; display: none">
              <% form_tag play_contest_custom_match_url(@contest, mm), :method => :post, :id => "form_#{mm.id}" do %>
                Priorit√§t:
                <%= text_field_tag :priority, 0, :size => 1 %>
                &nbsp;&nbsp;<a id="start_<%= mm.id %>" href="#"><%= t("actions.play") %></a>
                &nbsp;&nbsp;<a id="cancel_<%= mm.id %>" href="#"><%= t("actions.cancel") %></a>
              <% end %>
            </div>
            <% javascript_tag do %>
              $(function() {
                $("#start_<%= mm.id %>").bind('click', function() {
                  $("#form_<%= mm.id %>").submit(); 
                })
                $("#open_box_<%= mm.id %>").bind('click', function() {
                  $("#prio_box_<%= mm.id %>").fadeIn(250);
                })
                $("#cancel_<%= mm.id %>").bind('click', function() {
                  $("#prio_box_<%= mm.id %>").fadeOut(250);
                })
              })
            <% end %>
          <% elsif mm.running? %>
            <%= t("helpers.playing_in_progress") %>&nbsp;
            (<%= mm.rounds.played.count %> / <%= mm.rounds.count %> gespielt) 
            &nbsp;&nbsp;<%= image_tag "ui/spinner.gif", :style => "vertical-align: middle" %>
          <% elsif mm.played? %>
            <% res = mm.main_result %>
            <%= link_to "#{res[0]} : #{res[1]}", contest_custom_match_url(@contest, mm) %>&nbsp; 
          <% end %>

          <% unless mm.running? %>
            <%= link_to t("actions.delete"), contest_custom_match_url(@contest, mm), :method => "delete" %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>
<% end %>
