<% preliminary_contestants = preliminary_contestants || @preliminary_contestants %>
<% show_surveys = @contest.phase == "recall" or @contest.phase =="validation" %>
<table class="tablesorter data-table" id="preliminary_contestants">
    <thead>
      <tr>
        <th><%= t "views.name" %></th>
        <th><%= School.human_name %></th>
        <th><%= t "views.location" %></th>
        <th><%= School.human_attribute_name :state %></th>
         
        <% if show_surveys %><th class="middle">Umfragen &nbsp </th><% end %>
        <th class="middle">Teilnahmewahrscheinlichkeit</th>
        <th class="middle">Aktionen</th>
      </tr>
    </thead>
    <tbody>
      <% preliminary_contestants.each do |prelim| %>
       <tr class="preliminary_contestant <%= prelim.school.state.downcase %>">
        <td><%= prelim.name %></td>
        <td><%= prelim.school.name %></td>
        <td><%= prelim.school.location %></td>
        <td><%= prelim.school.state %></td>
        <% if show_surveys %>
          <% tokens = prelim.survey_tokens.select{|st| st.allowed_for? @current_user} %>
          <td class="middle">
           <% if tokens.empty? %>
             <% show_to :administrator do %>
              <%= image_tag "state/warning.png", :class => 'tooltipped', :title => "Keine UmfragemÃ¶glichkeiten!" %>
             <% end %>
           <% else  %>
              <% if tokens.all?{|st| st.complete?} %>
                <%= image_tag "state/ok.png", :class => 'tooltipped', :title => "Alle (#{tokens.count}) Umfragen beantwortet" %>
              <% else %>
                <% f = tokens.select{|st| st.complete?} %>
                <%= image_tag "state/attention.png", :class => "tooltipped", :title => "Es wurden #{f.length} von #{tokens.count} Umfragen abgeschlossen" %>
              <% end %>
            <% end %>
          </td>
        <% end %>
        <td class="middle"><%= show_probability prelim.participation_probability %></td>
        <td style="text-align:center"><%= link_to image_tag("actions/show.png"), contest_preliminary_contestant_url(@contest,prelim) %></td>
       </tr>
      <% end %>
      </tbody>
 </table> 
