<%
render_tabnav :contest, :html => { :class => "tabs_tabnav" } do
 
  add_tab do |t|
    t.named t("titles.overview")
    begin; t.disable!; next; end if @contest.new_record?
    t.links_to contest_url(@contest)
    t.highlights_on :controller => "contests", :action => "show"
  end

  show_to :administrator do

    add_tab do |t|
        t.named t("actions.create").capitalize
        t.links_to new_contest_url
        t.highlights_on :controller => "contests", :action => "new"
    end if @contest.new_record?
  
  end
  
#  if @contest.ready? or administrator?
    add_tab do |t|
      t.named t("titles.schedule")
      begin; t.disable!; next; end if @contest.new_record?
      t.links_to contest_edit_schedule_url(@contest)
      t.disable! unless @contest.ready? or administrator?
      t.highlights_on :controller => "contests", :action => "edit_schedule"
    end if @contest.phase == "contest"
 # end

  add_tab do |t|
    t.named Contestant.human_name(:count => 2)
    begin; t.disable!; next; end if @contest.new_record?
    t.links_to contest_contestants_url(@contest)
    t.highlights_on :controller => "contestants", :action => "index"
  end if @contest.phase == "contest"

  add_tab do |t|
    t.named t("views.my") + " " + Contestant.human_name(:count => 2)
    begin; t.disable!; next; end if @contest.new_record?
    t.links_to my_contest_contestants_url(@contest)
    t.highlights_on :controller => "contestants", :action => "my"
  end if logged_in? and current_user.contestants.visible.for_contest(@contest).count > 0

  #add_tab do |t|
  #  t.named t("titles.matchdays.list")
  #  begin; t.disable!; next; end if @contest.new_record?
  #  t.links_to contest_matchdays_url(@contest)
  #  t.disable! unless @contest.ready?
  #end

  add_tab do |t|
    t.named t("titles.ranking")
    begin; t.disable!; next; end if @contest.new_record?
    t.links_to contest_standings_url(@contest)
    t.disable! unless @contest.last_played_matchday
    t.highlights_on :controller => "contests", :action => "standings"
  end if @contest.phase == "contest"

  add_tab do |t|
    t.named t("titles.results")
    begin; t.disable!; next; end if @contest.new_record?
    t.named "#{@contest.last_played_matchday.position}. Spieltag" if @contest.last_played_matchday
    t.links_to contest_results_url(@contest)
    t.disable! unless @contest.last_played_matchday
    t.highlights_on :controller => "contests", :action => "results"
  end if @contest.phase == "contest"

  if logged_in? and current_user.is_member_of_a_team?(@contest)
    add_tab do |t|
      t.named FriendlyEncounter.human_name(:count => 2)
      t.links_to contest_friendly_encounters_url(@contest)
      t.highlights_on :controller => "friendly_encounters", :action => "index"
    end
  end

  if (logged_in? and not (current_user.schools_for_contest(@contest).empty? and current_user.other_schools_for_contest(@contest).empty?)) or administrator?
    add_tab do |t|
      begin; t.named "#{t "views.my"} #{School.human_name(:count => 2)}/#{PreliminaryContestant.human_name(:count => 2)}"; end if not administrator?
      begin; t.named "#{t "views.all"} #{School.human_name(:count => 2)}/#{PreliminaryContestant.human_name(:count => 2)}"; end if administrator?
      t.links_to contest_schools_url(@contest)
      t.highlights_on :controller => "schools", :action => "index"
    end
  end

    if (@contest.regular_phase_finished?) and ((not @contest.finale.nil? and @contest.finale.published?) or (not current_user.nil? and current_user.has_role?(:administrator)) or (not @contest.finale.nil? and @contest.finale.has_published_lineup?))
      add_tab do |t|
        t.named Finale.human_name.gsub(" ", "&nbsp;")
        t.links_to contest_finale_url(@contest)
      end
    end

  if (administrator? or (logged_in? and current_user.is_member_of_a_team?(@contest) and not @contest.trial_contest.nil?)) and not @contest.is_trial_contest?
    add_tab do |t|
      t.named Contest.human_attribute_name("trial_contest")
      t.links_to trial_contest_contest_url(@contest)
      t.highlights_on :controller => "contests", :action => "trial_contest"
    end if @contest.phase == "contest"
  end

  if @contest.is_trial_contest?
    add_tab do |t|
      t.named Contest.human_attribute_name("main_contest")
      t.links_to contest_url(@contest.main_contest)
    end
  end
  
end
%>
