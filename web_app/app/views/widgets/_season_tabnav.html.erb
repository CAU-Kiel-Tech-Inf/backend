<%
render_tabnav :season, :html => { :class => "tabs_tabnav" } do
 if @season
  add_tab do |t|
    t.named t("titles.overview")
    t.links_to season_url(@season)
    t.highlights_on :controller => "seasons", :action => "show"
  end
  
  add_tab do |t|
    t.named "Neuigkeiten"
    t.links_to url_for [@season, :news_posts]
    t.highlights_on :controller => "news_posts"
  end unless @season.news_posts.published.empty?

  add_tab do |t| 
    t.named t("titles.surveys")
    t.links_to url_for [@season, :survey_tokens]
    t.highlights_on :controller => "survey_tokens"
    t.highlights_on :controller => "surveys"
  end if @current_user and (@current_user.survey_token_available? or administrator? or @current_user.has_role?(:tutor) or @current_user.has_role?(:helper))

  if ((logged_in? and not (current_user.schools_for_season(@season).empty? and current_user.other_schools_for_season(@season).empty?)) or administrator?) and not (@season.contest? or @season.finished?)
    add_tab do |t|
      begin; t.named "#{t "views.my"} #{School.human_name(:count => 2)}"; end if not administrator?
      begin; t.named "#{t "views.all"} #{School.human_name(:count => 2)}"; end if administrator?
      t.links_to season_schools_url(@season)
      t.highlights_on :controller => "schools", :action => "index"
    end
  end if @season.schools_visible?

  if logged_in? and (administrator? or not @current_user.preliminary_contestants.empty?) and not (@season.contest? or @season.finished?)
    add_tab do |t|
      t.named "#{t "views.all"} #{PreliminaryContestant.human_name(:count => 2)}" if administrator?
      t.named "#{t "views.my" } #{PreliminaryContestant.human_name(:count => 2)}" if not administrator?
      t.links_to season_preliminary_contestants_url(@season)
      t.highlights_on :controller => "preliminary_contestants"
    end if @season.preliminary_contestants_visible?
  end
  add_tab do |t|
    t.named Contest.human_name(:count => 2)
    t.links_to contests_season_url(@season)
    t.highlights_on :controller => "seasons", :actions => "contests"
  end if @season.contest? or @season.finished?

  if @season.preparation? or @season.contest? or @season.finished?

    add_tab do |t|
      t.named t("views.my") + " " + Contestant.human_name(:count => 2)
      begin; t.disable!; next; end if @season.new_record?
      t.links_to url_for [:my, @season, :contestants]
      t.highlights_on :controller => "contestants", :action => "my"
    end if logged_in? and current_user.contestants.visible.for_season(@season).count > 0

    add_tab do |t|
      t.named t("titles.contestants.index")
      t.links_to season_contestants_url(@season)
      t.highlights_on :controller => "contestants", :action => :index
    end 

    if logged_in? and current_user.contestants.visible.for_season(@season).count > 0
      add_tab do |t|
        t.named t("titles.friendly_encounters.index")
        t.links_to season_friendly_encounters_url(@season)
        t.highlights_on :controller => "friendly_encounters"
      end
    end
  end
 end
end
%>
