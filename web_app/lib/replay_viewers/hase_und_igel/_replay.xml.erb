<data>
<% Zlib::GzipReader.open(replay) do |gz| %>
  <% n = Nokogiri::XML(gz.read.gsub('hui:', '')) %>
  <%= n.xpath('/object-stream/gameState[1]/game/board').to_xml.html_safe! %>
  <% if n %>
    <% n.xpath('/object-stream/gameState').each do |gameState| %>
      <% gameState.xpath('./game/player').first.name = "red" %>
      <% gameState.xpath('./game/player').first.name = "blue" %>
    <% end %>
    <redStates>
     <% n.xpath('object-stream/gameState').each do |state|%>
      <%= state.xpath('./game/red').remove_attr("class").to_xml.html_safe! %>
     <% end %>
    </redStates>
    <blueStates>
      <% n.xpath('object-stream/gameState').each do |state|%>
       <%= state.xpath('./game/blue').remove_attr("class").to_xml.html_safe! %>
      <% end %>
    </blueStates>
    <turns>
      <% n.xpath('object-stream/gameState').each do |state| %>
        <turn round="<%= state.xpath('./game/turn').text.to_i+1 %>" player="<%= state.xpath('./game/activePlayer/color').text %>"/>
      <% end %>
    </turns>
  <% end %>
 <% end %>
</data>
