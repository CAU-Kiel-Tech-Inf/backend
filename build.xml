<project name="Complete" basedir="." default="main">
  <import file="git-build.xml" />

  <property name="out.dir" value="deploy" />

  <target name="clean">
    <delete dir="${out.dir}" />
    <delete dir="game_server/build" />
    <delete dir="game_gui/build" />
    <!--    old Plugins                        !-->
    <delete dir="game_plugins/tic_tac_toe/build" />
    <delete dir="game_players/hase_und_igel/build" />
    <delete dir="game_plugins/schaefchen_im_trockenen/build" />
    <delete dir="game_players/schaefchen_im_trockenen/build" />
    <delete dir="game_plugins/manhattan/build" />
    <delete dir="game_players/manhattan/build" />
    <delete dir="game_players/manhattan_player2/build" />
    <delete dir="game_plugins/cartagena/build" />
    <delete dir="game_players/cartagena_player/build" />
    <delete dir="game_players/cartagena_player2/build" />
    <delete dir="game_plugins/sixpack/build" />
    <delete dir="game_players/sixpack/build" />
    <delete dir="game_plugins/hey_danke_fuer_den_fisch/build" />
    <delete dir="game_players/hey_danke_fuer_den_fisch/build" />
    <delete dir="game_players/hey_danke_fuer_den_fisch_player2/build" />
    <!--    currentPlugin                    !-->
    <delete dir="game_plugins/twixt/build" />
    <delete dir="game_players/twixt_player/build" />
    <delete dir="game_players/twixt_player2/build" />

  </target>

  <target name="dependencies">
    <echo message="Compiling SDK..." />
    <ant dir="software_challenge_sdk" target="clean-build" inheritAll="false" />

    <echo message="Compiling Plugins and Players..." />
    <!--<ant dir="game_plugins/hase_und_igel" target="clean-build" inheritAll="false" />
        <ant dir="game_players/hase_und_igel" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/schaefchen_im_trockenen" target="clean-build" inheritAll="false" />
        <ant dir="game_players/schaefchen_im_trockenen" target="clean-build" inheritAll="false" />
        <ant dir="game_players/schaefchen_im_trockenen2" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/manhattan" target="clean-build" inheritAll="false" />
        <ant dir="game_players/manhattan" target="clean-build" inheritAll="false" />
        <ant dir="game_players/manhattan_player2" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/cartagena" target="clean-build" inheritAll="false" />
        <ant dir="game_players/cartagena_player/" target="clean-build" inheritAll="false" />
        <ant dir="game_players/cartagena_player2/" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/sixpack" target="clean-build" inheritAll="false" />
        <ant dir="game_players/sixpack" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/hey_danke_fuer_den_fisch" target="clean-build" inheritAll="false" />
        <ant dir="game_players/hey_danke_fuer_den_fisch" target="clean-build" inheritAll="false" />
        <ant dir="game_players/hey_danke_fuer_den_fisch_player2" target="clean-build" inheritAll="false" /> !-->
        <!--    currentPlugin                    !-->
        <ant dir="game_plugins/twixt" target="clean-build" inheritAll="false" />
        <ant dir="game_players/twixt_player" target="clean-build" inheritAll="false" />
        <ant dir="game_players/twixt_player2" target="clean-build" inheritAll="false" />

        <echo message="Compiling Server and GUI..." />
        <ant dir="game_server" target="clean-build" inheritAll="false" />
        <ant dir="game_gui" target="clean-build" inheritAll="false" />
  </target>

  <target name="build" depends="scmversion,dependencies">
    <mkdir dir="${out.dir}" />

    <mkdir dir="${out.dir}/gui" />
    <mkdir dir="${out.dir}/gui/java7" />
    <mkdir dir="${out.dir}/gui/java8" />

    <copy todir="${out.dir}/gui/java7">
      <fileset dir="./game_gui/build/jar" excludes="*/twixt_java8.jar" />
    </copy>

    <copy todir="${out.dir}/gui/java8">
      <fileset dir="./game_gui/build/jar" excludes="*/twixt_java7.jar" />
    </copy>

    <mkdir dir="${out.dir}/server" />
    <copy todir="${out.dir}/server">
      <fileset dir="./game_server/build/jar" />
    </copy>

    <!-- #####     Clients   #####     !-->

    <mkdir dir="${out.dir}/not_so_simple_client/twixt_player/jar" />
    <mkdir dir="${out.dir}/not_so_simple_client/twixt_player/jar/java7" />
    <mkdir dir="${out.dir}/not_so_simple_client/twixt_player/jar/java8" />
    <copy todir="${out.dir}/not_so_simple_client/twixt_player/jar">
      <fileset dir="./game_players/twixt_player2/build/jar" />
    </copy>

    <mkdir dir="${out.dir}/simple_client/twixt_player/jar" />
    <mkdir dir="${out.dir}/simple_client/twixt_player/jar/java7" />
    <mkdir dir="${out.dir}/simple_client/twixt_player/jar/java8" />
    <copy todir="${out.dir}/simple_client/twixt_player/jar">
      <fileset dir="./game_players/twixt_player/build/jar" />
    </copy>



    <mkdir dir="${out.dir}/simple_client/twixt_player/src" />
    <copy todir="${out.dir}/simple_client/twixt_player/src">
      <fileset dir="./game_players/twixt_player">
        <exclude name="build/**/*" />
        <exclude name="bin/**/*" />
        <exclude name=".classpath" />
        <exclude name="build.xml" />
      </fileset>
    </copy>
    <move tofile="${out.dir}/simple_client/twixt_player/src/build.xml" file="${out.dir}/simple_client/twixt_player/src/build-deploy.xml" />

    <mkdir dir="${out.dir}/simple_client/twixt_player/src/lib" />
    <copy todir="${out.dir}/simple_client/twixt_player/src/lib">
      <fileset dir="${out.dir}/simple_client/twixt_player/jar/java7/lib" />
    </copy>



    <!-->####    PLUGINS             !-->
    <mkdir dir="game_gui/plugins" />
    <copy todir="game_gui/plugins" flatten="true">
      <fileset dir="game_plugins" includes="*/build/jar/*.jar"/>
    </copy>
    <mkdir dir="game_server/plugins" />
    <copy todir="game_server/plugins" flatten="true">
      <fileset dir="game_plugins" includes="*/build/jar/*.jar"/>
    </copy>

    <echo message="Generating Starter-Batchfiles" />

    <touch file="${out.dir}/gui/java7/start.bat" />
    <echo message="java -Dfile.encoding=UTF-8 -jar softwarechallenge-gui.jar" file="${out.dir}/gui/java7/start.bat" />
    <touch file="${out.dir}/gui/java8/start.bat" />
    <echo message="java -Dfile.encoding=UTF-8 -jar softwarechallenge-gui.jar" file="${out.dir}/gui/java8/start.bat" />
    <echo message="java -Dfile.encoding=UTF-8 -jar softwarechallenge-server.jar" file="${out.dir}/server/start.bat" />

    <echo message="Zipping files..." />

    <mkdir dir="${out.dir}/zipped" />

    <zip destfile="${out.dir}/zipped/server-gui-java7.zip" basedir="${out.dir}/gui/java7" />
    <zip destfile="${out.dir}/zipped/server-gui-java8.zip" basedir="${out.dir}/gui/java8" />

    <zip destfile="${out.dir}/zipped/server.zip" basedir="${out.dir}/server" />

    <echo message="Gathering documentations..." />
    <mkdir dir="${out.dir}/zipped/doc" />
    <zip destfile="${out.dir}/zipped/doc/software_challenge_sdk-doc.zip" basedir="software_challenge_sdk/doc" />
    <zip destfile="${out.dir}/zipped/doc/gui-doc.zip" basedir="game_gui/doc" />
    <zip destfile="${out.dir}/zipped/doc/server-doc.zip" basedir="game_server/doc" />
    <zip destfile="${out.dir}/zipped/notsosimpleclient-twixt-jar-java7.zip" basedir="${out.dir}/not_so_simple_client/twixt_player/jar/java7" />
    <zip destfile="${out.dir}/zipped/notsosimpleclient-twixt-jar-java8.zip" basedir="${out.dir}/not_so_simple_client/twixt_player/jar/java8" />
    <zip destfile="${out.dir}/zipped/simpleclient-twixt-jar-java7.zip" basedir="${out.dir}/simple_client/twixt_player/jar/java7" />
    <zip destfile="${out.dir}/zipped/simpleclient-twixt-jar-java8.zip" basedir="${out.dir}/simple_client/twixt_player/jar/java8" />
    <zip destfile="${out.dir}/zipped/simpleclient-twixt-src.zip" basedir="${out.dir}/simple_client/twixt_player/src" />

  </target>

  <target name="clean-build" depends="clean,build" />

  <target name="main" depends="clean-build" />
</project>
