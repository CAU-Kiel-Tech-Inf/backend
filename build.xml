<project name="Complete" basedir="." default="main">
	<import file="svn-build.xml" />

	<property name="out.dir" value="deploy" />

	<target name="clean">
		<delete dir="${out.dir}" />
		<delete dir="game_server/build" />
		<delete dir="game_gui/build" />
		<delete dir="game_plugins/hase_und_igel/build" />
		<delete dir="game_plugins/tic_tac_toe/build" />
		<delete dir="game_players/hase_und_igel/build" />
	</target>

	<target name="dependencies">
		<echo message="Compiling SDK..." />
		<ant dir="software_challenge_sdk" target="clean-build" inheritAll="false" />
		
		<echo message="Compiling Plugins and Players..." />
		<ant dir="game_plugins/hase_und_igel" target="clean-build" inheritAll="false" />
		<ant dir="game_players/hase_und_igel" target="clean-build" inheritAll="false" />
		
		<echo message="Compiling Server and GUI..." />
		<ant dir="game_server" target="clean-build" inheritAll="false" />
		<ant dir="game_gui" target="clean-build" inheritAll="false" />
	</target>

	<target name="build" depends="svnversion,dependencies">
		<mkdir dir="${out.dir}" />

		<mkdir dir="${out.dir}/gui" />
		<copy todir="${out.dir}/gui">
			<fileset dir="./game_gui/build/jar" />
		</copy>

		<mkdir dir="${out.dir}/server" />
		<copy todir="${out.dir}/server">
			<fileset dir="./game_server/build/jar" />
		</copy>

		<mkdir dir="${out.dir}/simple_client/jar" />
		<copy todir="${out.dir}/simple_client/jar">
			<fileset dir="./game_players/hase_und_igel/build/jar" />
		</copy>

		<mkdir dir="${out.dir}/simple_client/src" />
		<copy todir="${out.dir}/simple_client/src">
			<fileset dir="./game_players/hase_und_igel">
				<exclude name="build/**/*" />
				<exclude name="bin/**/*" />
				<exclude name=".classpath" />
			</fileset>
		</copy>
		
		<move tofile="${out.dir}/simple_client/src/.classpath" file="${out.dir}/simple_client/src/.deployed_classpath" />

		<mkdir dir="${out.dir}/simple_client/src/lib" />
		<copy todir="${out.dir}/simple_client/src/lib">
			<fileset dir="${out.dir}/simple_client/jar/lib" />
		</copy>

		<echo message="Generating Starter-Batchfiles" />

		<touch file="${out.dir}/gui/start.bat" />
		<echo message="java -Dfile.encoding=UTF-8 -jar softwarechallenge-gui.jar" file="${out.dir}/gui/start.bat" />
		<echo message="java -Dfile.encoding=UTF-8 -jar softwarechallenge-server.jar" file="${out.dir}/server/start.bat" />

		<echo message="Zipping files..." />

		<mkdir dir="${out.dir}/zipped" />

		<zip destfile="${out.dir}/zipped/gui.zip" basedir="${out.dir}/gui" />

		<zip destfile="${out.dir}/zipped/server.zip" basedir="${out.dir}/server" />

		<zip destfile="${out.dir}/zipped/simpleclient-jar.zip" basedir="${out.dir}/simple_client/jar" />

		<zip destfile="${out.dir}/zipped/simpleclient-src.zip" basedir="${out.dir}/simple_client/src" />
	</target>

	<target name="clean-build" depends="clean,build" />

	<target name="main" depends="clean-build" />
</project>