<project name="Complete" basedir="." default="main">
	<import file="git-build.xml" />

	<property name="out.dir" value="deploy" />

	<target name="clean">
		<delete dir="${out.dir}" />
		<delete dir="game_server/build" />
		<delete dir="game_gui/build" />
		<!--><delete dir="game_plugins/tic_tac_toe/build" />
		<delete dir="game_players/hase_und_igel/build" />
		<delete dir="game_plugins/schaefchen_im_trockenen/build" />
		<delete dir="game_players/schaefchen_im_trockenen/build" />!-->
		<delete dir="game_plugins/manhattan/build" />
		<delete dir="game_players/manhattan/build" />
		<delete dir="game_plugins/qwirkle/build"  />
		<delete dir="game_players/manhattan_player2/build" />
		<delete dir="game_plugins/cartagena/build" />
		<delete dir="game_players/cartagena_player/build" />
	</target>

	<target name="dependencies">
		<echo message="Compiling SDK..." />
		<ant dir="software_challenge_sdk" target="clean-build" inheritAll="false" />
		
		<echo message="Compiling Plugins and Players..." />
		<!--<ant dir="game_plugins/hase_und_igel" target="clean-build" inheritAll="false" />
		<ant dir="game_players/hase_und_igel" target="clean-build" inheritAll="false" />
		<ant dir="game_plugins/schaefchen_im_trockenen" target="clean-build" inheritAll="false" />
		<ant dir="game_players/schaefchen_im_trockenen" target="clean-build" inheritAll="false" />
		<ant dir="game_players/schaefchen_im_trockenen2" target="clean-build" inheritAll="false" />
		<ant dir="game_plugins/manhattan" target="clean-build" inheritAll="false" />
		<ant dir="game_players/manhattan" target="clean-build" inheritAll="false" />
		<ant dir="game_players/manhattan_player2" target="clean-build" inheritAll="false" />!-->
		<ant dir="game_plugins/cartagena" target="clean-build" inheritAll="false" />
		<ant dir="game_players/cartagena_player/" target="clean-build" inheritAll="false" />
		
		<echo message="Compiling Server and GUI..." />
		<ant dir="game_server" target="clean-build" inheritAll="false" />
		<ant dir="game_gui" target="clean-build" inheritAll="false" />
	</target>

	<target name="build" depends="scmversion,dependencies">
		<mkdir dir="${out.dir}" />

		<mkdir dir="${out.dir}/gui" />
		<copy todir="${out.dir}/gui">
			<fileset dir="./game_gui/build/jar" />
		</copy>

		<mkdir dir="${out.dir}/server" />
		<copy todir="${out.dir}/server">
			<fileset dir="./game_server/build/jar" />
		</copy>

		<!--
		<mkdir dir="${out.dir}/simple_client/hase_und_igel/jar" />
		<copy todir="${out.dir}/simple_client/hase_und_igel/jar">
			<fileset dir="./game_players/hase_und_igel/build/jar" />
		</copy>
	
		
		
		<mkdir dir="${out.dir}/simple_client/schaefchen_im_trockenen/jar" />
		<copy todir="${out.dir}/simple_client/schaefchen_im_trockenen/jar">
			<fileset dir="./game_players/schaefchen_im_trockenen/build/jar" />
		</copy>
	
		<copy todir="${out.dir}/simple_client/schaefchen_im_trockenen2/jar">
			<fileset dir="./game_players/schaefchen_im_trockenen2/build/jar" />
		</copy>
		
		
		<mkdir dir="${out.dir}/simple_client/manhattan/jar" />
		<copy todir="${out.dir}/simple_client/manhattan/jar">
			<fileset dir="./game_players/manhattan/build/jar" />
		</copy>

		<mkdir dir="${out.dir}/not_so_simple_client/manhattan/jar" />
		<copy todir="${out.dir}/not_so_simple_client/manhattan/jar">
			<fileset dir="./game_players/manhattan_player2/build/jar" />
		</copy>!-->
		
		<mkdir dir="${out.dir}/simple_client/cartagena/jar" />
		<copy todir="${out.dir}/simple_client/cartagena/jar">
			<fileset dir="./game_players/cartagena_player/build/jar" />
		</copy>
		
		<!--
		<mkdir dir="${out.dir}/simple_client/hase_und_igel/src" />
		<copy todir="${out.dir}/simple_client/hase_und_igel/src">
			<fileset dir="./game_players/hase_und_igel">
				<exclude name="build/**/*" />
				<exclude name="bin/**/*" />
				<exclude name=".classpath" />
			</fileset>
		</copy>
		!-->
	
		<!--
		<mkdir dir="${out.dir}/simple_client/schaefchen_im_trockenen/src" />
		<copy todir="${out.dir}/simple_client/schaefchen_im_trockenen/src">
			<fileset dir="./game_players/schaefchen_im_trockenen">
				<exclude name="build/**/*" />
				<exclude name="bin/**/*" />
				<exclude name=".classpath" />
				<exclude name="build.xml" />
			</fileset>
		</copy>
		<move tofile="${out.dir}/simple_client/schaefchen_im_trockenen/src/build.xml" file="${out.dir}/simple_client/schaefchen_im_trockenen/src/build-deploy.xml" />
		

		<mkdir dir="${out.dir}/simple_client/manhattan/src" />
		<copy todir="${out.dir}/simple_client/manhattan/src">
			<fileset dir="./game_players/manhattan">
				<exclude name="build/**/*" />
				<exclude name="bin/**/*" />
				<exclude name=".classpath" />
				<exclude name="build.xml" />
			</fileset>
		</copy>
		<move tofile="${out.dir}/simple_client/manhattan/src/build.xml" file="${out.dir}/simple_client/manhattan/src/build-deploy.xml" />!-->
		
		<mkdir dir="${out.dir}/simple_client/cartagena/src" />
		<copy todir="${out.dir}/simple_client/cartagena/src">
			<fileset dir="./game_players/cartagena_player">
				<exclude name="build/**/*" />
				<exclude name="bin/**/*" />
				<exclude name=".classpath" />
				<exclude name="build.xml" />
			</fileset>
		</copy>
		<move tofile="${out.dir}/simple_client/cartagena/src/build.xml" file="${out.dir}/simple_client/cartagena/src/build-deploy.xml" />


		<!--
		<move tofile="${out.dir}/simple_client/hase_und_igel/src/.classpath" file="${out.dir}/simple_client/hase_und_igel/src/.deployed_classpath" />

		<mkdir dir="${out.dir}/simple_client/hase_und_igel/src/lib" />
		<copy todir="${out.dir}/simple_client/hase_und_igel/src/lib">
			<fileset dir="${out.dir}/simple_client/hase_und_igel/jar/lib" />
		</copy>
		!-->
		<!--
		<mkdir dir="${out.dir}/simple_client/schaefchen_im_trockenen/src/lib" />
		<copy todir="${out.dir}/simple_client/schaefchen_im_trockenen/src/lib">
			<fileset dir="${out.dir}/simple_client/schaefchen_im_trockenen/jar/lib" />
		</copy>
		

		<mkdir dir="${out.dir}/simple_client/manhattan/src/lib" />
		<copy todir="${out.dir}/simple_client/manhattan/src/lib">
			<fileset dir="${out.dir}/simple_client/manhattan/jar/lib" />
		</copy>!-->
		
		<mkdir dir="${out.dir}/simple_client/cartagena/src/lib" />
		<copy todir="${out.dir}/simple_client/cartagena/src/lib">
			<fileset dir="${out.dir}/simple_client/cartagena/jar/lib" />
		</copy>


		<mkdir dir="game_gui/plugins" />
		<copy todir="game_gui/plugins" flatten="true">
			<fileset dir="game_plugins" includes="*/build/jar/*.jar"/>
		</copy>
		<mkdir dir="game_server/plugins" />
		<copy todir="game_server/plugins" flatten="true">
			<fileset dir="game_plugins" includes="*/build/jar/*.jar"/>
		</copy>

		<echo message="Generating Starter-Batchfiles" />

		<touch file="${out.dir}/gui/start.bat" />
		<echo message="java -Dfile.encoding=UTF-8 -jar softwarechallenge-gui.jar" file="${out.dir}/gui/start.bat" />
		<echo message="java -Dfile.encoding=UTF-8 -jar softwarechallenge-server.jar" file="${out.dir}/server/start.bat" />

		<echo message="Zipping files..." />

		<mkdir dir="${out.dir}/zipped" />

		<zip destfile="${out.dir}/zipped/server-gui.zip" basedir="${out.dir}/gui" />

		<zip destfile="${out.dir}/zipped/server.zip" basedir="${out.dir}/server" />

		<!--
		<zip destfile="${out.dir}/zipped/simpleclient-hui-jar.zip" basedir="${out.dir}/simple_client/hase_und_igel/jar" />
		<zip destfile="${out.dir}/zipped/simpleclient-hui-src.zip" basedir="${out.dir}/simple_client/hase_und_igel/src" />
		!-->
		<!--
		<zip destfile="${out.dir}/zipped/challenger-sit.zip" basedir="${out.dir}/simple_client/schaefchen_im_trockenen2/jar" />
		<zip destfile="${out.dir}/zipped/simpleclient-sit-jar.zip" basedir="${out.dir}/simple_client/schaefchen_im_trockenen/jar" />
		<zip destfile="${out.dir}/zipped/simpleclient-sit-src.zip" basedir="${out.dir}/simple_client/schaefchen_im_trockenen/src" />
		
		<zip destfile="${out.dir}/zipped/simpleclient-mh-jar.zip" basedir="${out.dir}/simple_client/manhattan/jar" />
		<zip destfile="${out.dir}/zipped/simpleclient-mh-src.zip" basedir="${out.dir}/simple_client/manhattan/src" />
		<zip destfile="${out.dir}/zipped/not-so-simpleclient-mh-jar.zip" basedir="${out.dir}/not_so_simple_client/manhattan/jar" />!-->
		
		<zip destfile="${out.dir}/zipped/simpleclient-ca-jar.zip" basedir="${out.dir}/simple_client/cartagena/jar" />
		<zip destfile="${out.dir}/zipped/simpleclient-ca-src.zip" basedir="${out.dir}/simple_client/cartagena/src" />
		

		<echo message="Gathering documentations..." />
		<mkdir dir="${out.dir}/zipped/doc" />
		<zip destfile="${out.dir}/zipped/doc/software_challenge_sdk-doc.zip" basedir="software_challenge_sdk/doc" />
		<zip destfile="${out.dir}/zipped/doc/gui-doc.zip" basedir="game_gui/doc" />
		<zip destfile="${out.dir}/zipped/doc/server-doc.zip" basedir="game_server/doc" />

	</target>

	<target name="clean-build" depends="clean,build" />

	<target name="main" depends="clean-build" />
</project>
