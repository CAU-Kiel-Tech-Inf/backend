<project name="Complete" basedir="." default="main">
  <import file="git-build.xml" />

  <property name="out.dir" value="deploy" />

  <target name="clean">
    <delete dir="${out.dir}" />
    <delete dir="game_server/build" />
    <delete dir="game_gui/build" />
    <!--    old Plugins                        !-->
    <delete dir="game_plugins/tic_tac_toe/build" />
    <delete dir="game_players/hase_und_igel/build" />
    <delete dir="game_plugins/schaefchen_im_trockenen/build" />
    <delete dir="game_players/schaefchen_im_trockenen/build" />
    <delete dir="game_plugins/manhattan/build" />
    <delete dir="game_players/manhattan/build" />
    <delete dir="game_players/manhattan_player2/build" />
    <delete dir="game_plugins/cartagena/build" />
    <delete dir="game_players/cartagena_player/build" />
    <delete dir="game_players/cartagena_player2/build" />
    <delete dir="game_plugins/sixpack/build" />
    <delete dir="game_players/sixpack/build" />
    <delete dir="game_plugins/hey_danke_fuer_den_fisch/build" />
    <delete dir="game_players/hey_danke_fuer_den_fisch/build" />
    <delete dir="game_players/hey_danke_fuer_den_fisch_player2/build" />
    <delete dir="game_plugins/twixt/build" />
    <delete dir="game_players/twixt_player/build" />
    <delete dir="game_players/twixt_player2/build" />
    <!--    currentPlugin                    !-->
    <delete dir="game_plugins/mississippi_queen/build" />
    <delete dir="game_players/mississippi_queen_player/build" />
    <!--<delete dir="game_players/mississippi_queen_player2/build" /> !-->
  </target>

  <target name="dependencies">
    <echo message="Compiling SDK..." />
    <ant dir="software_challenge_sdk" target="clean-build" inheritAll="false" />

    <echo message="Compiling Plugins and Players..." />
    <!--<ant dir="game_plugins/hase_und_igel" target="clean-build" inheritAll="false" />
        <ant dir="game_players/hase_und_igel" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/schaefchen_im_trockenen" target="clean-build" inheritAll="false" />
        <ant dir="game_players/schaefchen_im_trockenen" target="clean-build" inheritAll="false" />
        <ant dir="game_players/schaefchen_im_trockenen2" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/manhattan" target="clean-build" inheritAll="false" />
        <ant dir="game_players/manhattan" target="clean-build" inheritAll="false" />
        <ant dir="game_players/manhattan_player2" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/cartagena" target="clean-build" inheritAll="false" />
        <ant dir="game_players/cartagena_player/" target="clean-build" inheritAll="false" />
        <ant dir="game_players/cartagena_player2/" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/sixpack" target="clean-build" inheritAll="false" />
        <ant dir="game_players/sixpack" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/hey_danke_fuer_den_fisch" target="clean-build" inheritAll="false" />
        <ant dir="game_players/hey_danke_fuer_den_fisch" target="clean-build" inheritAll="false" />
        <ant dir="game_players/hey_danke_fuer_den_fisch_player2" target="clean-build" inheritAll="false" />
        <ant dir="game_plugins/twixt" target="clean-build" inheritAll="false" />
        <ant dir="game_players/twixt_player" target="clean-build" inheritAll="false" />
        <ant dir="game_players/twixt_player2" target="clean-build" inheritAll="false" /> !-->
        <!--    currentPlugin                    !-->
        <ant dir="game_plugins/mississippi_queen" target="clean-build" inheritAll="false" />
        <ant dir="game_players/mississippi_queen_player" target="clean-build" inheritAll="false" />
         <!--<ant dir="game_players/mississippi_queen_player2" target="clean-build" inheritAll="false" /> TODO!-->

        <echo message="Compiling Server and GUI..." />
        <ant dir="game_server" target="clean-build" inheritAll="false" />
        <ant dir="game_gui" target="clean-build" inheritAll="false" />
  </target>

  <target name="build" depends="scmversion,dependencies">
    <mkdir dir="${out.dir}" />

    <mkdir dir="${out.dir}/gui" />

    <copy todir="${out.dir}/gui">
      <fileset dir="./game_gui/build/jar" />
    </copy>

    <mkdir dir="${out.dir}/server" />
    <copy todir="${out.dir}/server">
      <fileset dir="./game_server/build/jar" />
    </copy>

    <mkdir dir="${out.dir}/simple_client/mississippi_queen_player/jar" />
    <copy todir="${out.dir}/simple_client/mississippi_queen_player/jar">
      <fileset dir="./game_players/mississippi_queen_player/build/jar" />
    </copy>

    <mkdir dir="${out.dir}/simple_client/mississippi_queen_player/src" />
    <copy todir="${out.dir}/simple_client/mississippi_queen_player/src">
      <fileset dir="./game_players/mississippi_queen_player">
        <exclude name="build/**/*" />
        <exclude name="bin/**/*" />
        <exclude name=".classpath" />
        <exclude name="build.xml" />
      </fileset>
    </copy>
    <move tofile="${out.dir}/simple_client/mississippi_queen_player/src/build.xml" file="${out.dir}/simple_client/mississippi_queen_player/src/build-deploy.xml" />
    <mkdir dir="${out.dir}/simple_client/mississippi_queen_player/src/lib" />
    <copy todir="${out.dir}/simple_client/mississippi_queen_player/src/lib">
      <fileset dir="${out.dir}/simple_client/mississippi_queen_player/jar/lib" />
    </copy>


    <!-->####    PLUGINS             !-->
    <mkdir dir="game_gui/plugins" />
    <copy todir="game_gui/plugins" flatten="true">
      <fileset dir="game_plugins" includes="*/build/jar/*.jar"/>
    </copy>
    <mkdir dir="game_server/plugins" />
    <copy todir="game_server/plugins" flatten="true">
      <fileset dir="game_plugins" includes="*/build/jar/*.jar"/>
    </copy>

    <echo message="Copy log configs" />

    <copy tofile="${out.dir}/gui/logback.xml" file="./game_server/configuration/logback-release.xml" />
    <copy tofile="${out.dir}/server/logback.xml" file="./game_server/configuration/logback-release.xml" />

    <echo message="Generating Starter-Batchfiles" />

    <!-- &#xD; is CR, &#xA; is LF. Windows needs CRLF, Unix needs LF -->
    <echo file="${out.dir}/gui/start.bat">java -Dfile.encoding=UTF-8 -Dlogback.configurationFile=./logback.xml -jar softwarechallenge-gui.jar --max_client_heapsize=256&#xD;&#xA;</echo>
    <echo file="${out.dir}/gui/start.sh">#!/bin/sh&#xA;java -Dfile.encoding=UTF-8 -Dlogback.configurationFile=./logback.xml -jar softwarechallenge-gui.jar --max_client_heapsize=256&#xA;</echo>
    <echo file="${out.dir}/server/start.bat">java -Dfile.encoding=UTF-8 -Dlogback.configurationFile=./logback.xml -jar softwarechallenge-server.jar&#xD;&#xA;</echo>
    <echo file="${out.dir}/server/start.sh">#!/bin/sh&#xA;java -Dfile.encoding=UTF-8 -Dlogback.configurationFile=./logback.xml -jar softwarechallenge-server.jar&#xA;</echo>

    <echo message="Zipping files..." />

    <mkdir dir="${out.dir}/zipped" />

    <zip destfile="${out.dir}/zipped/server-gui.zip" basedir="${out.dir}/gui" />

    <zip destfile="${out.dir}/zipped/server.zip" basedir="${out.dir}/server" />

    <echo message="Gathering documentations..." />
    <mkdir dir="${out.dir}/zipped/doc" />
    <zip destfile="${out.dir}/zipped/doc/software_challenge_sdk-doc.zip" basedir="software_challenge_sdk/doc" />
    <zip destfile="${out.dir}/zipped/doc/gui-doc.zip" basedir="game_gui/doc" />
    <zip destfile="${out.dir}/zipped/doc/server-doc.zip" basedir="game_server/doc" />
    <!-- TODO<zip destfile="${out.dir}/zipped/notsosimpleclient-mississippi_queen-jar.zip" basedir="${out.dir}/not_so_simple_client/mississippi_queen_player/jar" />-->
    <zip destfile="${out.dir}/zipped/simpleclient-mississippi_queen-jar.zip" basedir="${out.dir}/simple_client/mississippi_queen_player/jar" />
    <zip destfile="${out.dir}/zipped/simpleclient-mississippi_queen-src.zip" basedir="${out.dir}/simple_client/mississippi_queen_player/src" />

  </target>

  <target name="clean-build" depends="clean,build" />

  <target name="main" depends="clean-build" />
</project>
